<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relatório de Atendimento - Internet Mais</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #0d1117; /* Fundo escuro similar ao do logo */
            background-image: url('https://i.ibb.co/qG6jJvK/Logo-internet-MAIS.png'); /* Seu logo como imagem de fundo */
            background-size: cover; /* Cobre todo o fundo */
            background-repeat: no-repeat;
            background-position: center center;
            background-attachment: fixed; /* Fixa o logo no fundo */
            color: #e2e8f0; /* Texto geral claro */
        }
        @media print {
            body {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                background-image: none; /* Não imprimir o logo de fundo */
                background-color: #ffffff; /* Fundo branco para impressão */
                color: #333333; /* Texto escuro para impressão */
            }
            .no-print {
                display: none !important;
            }
            .print-break-inside-avoid {
                page-break-inside: avoid;
            }
            .shadow-xl {
                box-shadow: none !important;
            }
            /* Reset de cores para impressão */
            .max-w-7xl { background-color: #ffffff !important; box-shadow: none !important; border: 1px solid #e2e8f0 !important; }
            h1, h2, h3, h4, .text-slate-900, .text-slate-800, .text-slate-700, .text-slate-600 { color: #333333 !important; }
            .border-b, .border-t, .border, .border-l-4 { border-color: #e2e8f0 !important; }
            .bg-slate-50 { background-color: #f8fafc !important; border-color: #e2e8f0 !important; }
            .gradient-text { -webkit-text-fill-color: #4f46e5 !important; } /* Cor sólida para impressão */
            .ring-1 { border-color: #e2e8f0 !important; }
            .bg-red-100 { background-color: #fef2f2 !important; }
            .text-red-800 { color: #991b1b !important; }
            .bg-orange-100 { background-color: #fff7ed !important; }
            .text-orange-800 { color: #9a3412 !important; }
            .bg-yellow-100 { background-color: #fffbeb !important; }
            .text-yellow-800 { color: #92400e !important; }
            .bg-blue-100 { background-color: #eff6ff !important; }
            .text-blue-800 { color: #1e40af !important; }
            .text-slate-500 { color: #64748b !important; }
            .text-slate-400 { color: #94a3b8 !important; }
            .text-slate-200 { background-color: #e2e8f0 !important; }
            .from-sky-500 { background-color: #0ea5e9 !important; }
            .to-indigo-500 { background-color: #6366f1 !important; }
            .glass-card {
                background-color: rgba(30, 41, 59, 0.7); /* bg-slate-800/70 */
                backdrop-filter: blur(8px);
                border: 1px solid rgba(255, 255, 255, 0.1);
                transition: all 0.3s ease;
            }
            .glass-card:hover {
                border-color: rgba(0, 147, 213, 0.5); /* Azul do logo */
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            }
            .section-title {
                font-size: 1.25rem; /* text-xl */
                font-weight: 700; /* font-bold */
                color: #f1f5f9; /* text-slate-100 */
                margin-bottom: 1.25rem; /* mb-5 */
                padding-left: 0.75rem; /* pl-3 */
                border-left-width: 4px;
                border-color: #0093d5; /* Azul do logo */
            }
        }
        .gradient-text {
            background: linear-gradient(to right, #0093d5, #00c96c); /* Cores do logo */
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        details > summary {
            list-style: none;
        }
        details > summary::-webkit-details-marker {
            display: none;
        }
        details[open] summary .arrow-down {
            transform: rotate(180deg);
        }
        /* Ajustes de cor para elementos específicos */
        .text-slate-900 { color: #f8fafc; } /* Títulos principais */
        .text-slate-800 { color: #e2e8f0; } /* Títulos de seção, nomes */
        .text-slate-700 { color: #cbd5e1; } /* Labels, textos médios */
        .text-slate-600 { color: #94a3b8; } /* Textos secundários, descrições */
        .text-slate-500 { color: #64748b; } /* Textos de rodapé, notas */
        .border-b, .border-t, .border { border-color: #334155; } /* Bordas escuras */
        
        .bg-slate-50 {
            background-color: #1e293b; /* Fundo dos cards e gráficos */
            border-color: #334155; /* Borda dos cards e gráficos */
        }
        .ring-slate-200 { border-color: #334155; } /* Borda de detalhes abertos */

        /* Cores para os indicadores de notas baixas */
        .bg-red-100 { background-color: rgba(220, 38, 38, 0.2); }
        .text-red-800 { color: #f87171; }
        .ring-red-200 { border-color: rgba(220, 38, 38, 0.4); }

        .bg-orange-100 { background-color: rgba(245, 158, 11, 0.2); }
        .text-orange-800 { color: #fbbf24; }
        .ring-orange-200 { border-color: rgba(245, 158, 11, 0.4); }

        .bg-yellow-100 { background-color: rgba(234, 179, 8, 0.2); }
        .text-yellow-800 { color: #facc15; }
        .ring-yellow-200 { border-color: rgba(234, 179, 8, 0.4); }

        .bg-blue-100 { background-color: rgba(59, 130, 246, 0.2); }
        .text-blue-800 { color: #60a5fa; }
        .ring-blue-200 { border-color: rgba(59, 130, 246, 0.4); }

        .from-sky-500 { background-color: #0093d5; } /* Azul do logo */
        .to-indigo-500 { background-color: #00c96c; } /* Verde do logo */

        /* Cores do seletor */
        select {
            background-color: #1e293b;
            color: #e2e8f0;
            border-color: #334155;
        }
        select:focus {
            outline: none;
            ring-color: #0093d5; /* Azul do logo */
            border-color: #0093d5; /* Azul do logo */
        }

        /* Estilos das Abas */
        .page-tab {
            padding: 0.5rem 1rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            color: #94a3b8; /* text-slate-400 */
            transition: all 0.3s ease;
        }
        .page-tab:hover {
            color: #e2e8f0; /* text-slate-200 */
        }
        .page-tab.active {
            color: #0093d5; /* Azul do logo */
            border-bottom-color: #0093d5;
        }
        .page-content {
            display: none; /* Oculto por padrão */
        }
        .page-content.active {
            display: block; /* Visível quando ativo */
        }

    </style>
</head>
<body class="p-4 sm:p-6 md:p-10">
    <div class="max-w-7xl mx-auto bg-slate-900/70 backdrop-blur-lg rounded-2xl shadow-xl p-4 sm:p-8 md:p-12 relative border border-slate-700">
        
        <!-- Cabeçalho Principal (Responsivo) -->
        <header class="mb-8 flex flex-col md:flex-row md:justify-between md:items-center">
            <div class="text-left w-full text-center md:text-left">
                <h1 class="text-3xl md:text-4xl font-extrabold text-white">Relatório de Desempenho</h1>
                <h2 class="text-xl font-semibold gradient-text mt-1">Equipe de Suporte Técnico</h2>
            </div>
            <!-- Abas de Navegação (Responsivo) -->
            <div class="flex flex-wrap justify-center space-x-2 sm:space-x-4 border-b border-slate-700 no-print w-full mt-6 md:mt-0 md:w-auto">
                <button id="tab-overview" class="page-tab active" data-page="page-overview">Visão Geral</button>
                <button id="tab-comparative" class="page-tab" data-page="page-comparative">Comparativo</button>
                <button id="tab-ranking" class="page-tab" data-page="page-ranking">Ranking</button>
            </div>
        </header>

        <!-- Página 1: Visão Geral por Período -->
        <div id="page-overview" class="page-content active">
            <!-- Seletor de Mês e Métricas Chave (Responsivo) -->
            <section class="mb-8 print-break-inside-avoid">
                <div class="no-print mb-8 flex flex-col sm:flex-row sm:justify-between sm:items-start">
                    <h3 class="section-title w-full mb-4 sm:mb-0" style="margin-bottom: 0;">Métricas Chave</h3>
                    <div class="flex-shrink-0 flex flex-col items-start sm:items-end w-full sm:w-auto">
                        <div class="flex items-center space-x-2 w-full justify-between sm:justify-end">
                            <label for="month-select" class="text-sm font-medium text-gray-400">Período:</label>
                            <select id="month-select" class="bg-slate-800/60 border border-slate-700 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="agosto">01/08 a 30/08</option>
                                <option value="setembro">01/09 a 30/09</option>
                                <option value="outubro">01/10 a 24/10</option>
                                <option value="outubro-nov">24/10 a 04/11</option>
                                <option value="novembro-inicio">01/11 a 10/11</option>
                                <option value="novembro-meio" selected>10/11 a 20/11</option>
                            </select>
                        </div>
                        <p class="text-md text-gray-400 mt-2" id="period-text">10/11 a 20/11</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center" id="key-metrics">
                    <!-- Métricas serão inseridas aqui dinamicamente -->
                </div>
            </section>
            
            <!-- Layout Principal em Grid -->
            <div class="mt-8 grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Coluna Principal (2/3) -->
                <div class="lg:col-span-2 space-y-6">
                    <!-- Análise Qualitativa -->
                    <section class="print-break-inside-avoid" id="qualitative-section">
                        <h3 class="section-title" id="qualitative-title">Análise Qualitativa</h3>
                        <div class="glass-card p-4 sm:p-6 rounded-xl">
                            <p class="text-gray-400 text-sm mb-6" id="qualitative-description">
                                A maioria das notas baixas está associada a fatores externos (falhas massivas) ou solicitações financeiras/comerciais, sugerindo uma oportunidade de otimizar o direcionamento.
                            </p>
                            <div class="h-[350px] mb-6" id="low-scores-chart-container">
                                <canvas id="lowScoresChart"></canvas>
                            </div>
                            <div id="low-scores-analysis" class="space-y-3">
                                <!-- Detalhes das notas baixas serão inseridos aqui -->
                            </div>
                        </div>
                    </section>
                    <!-- Desempenho Individual -->
                    <section class="print-break-inside-avoid">
                        <h3 class="section-title">Desempenho por Atendente</h3>
                        <div id="team-performance" class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                            <!-- Cards de atendentes serão inseridos aqui -->
                        </div>
                    </section>
                </div>
                <!-- Barra Lateral (1/3) -->
                <div class="lg:col-span-1 space-y-6">
                    <!-- Motivos de Atendimento -->
                    <section class="print-break-inside-avoid">
                        <h3 class="section-title">Principais Motivos de Atendimento</h3>
                        <div class="glass-card p-4 sm:p-6 rounded-xl">
                            <div class="space-y-4" id="reasons-table">
                                <!-- Linhas da tabela serão inseridas aqui -->
                            </div>
                        </div>
                    </section>
                    <!-- Gráfico de Desempenho -->
                    <section class="print-break-inside-avoid">
                        <h3 class="section-title" id="chart-title">Desempenho da Equipe</h3>
                        <div class="glass-card p-4 sm:p-6 rounded-xl h-[450px]">
                            <canvas id="performanceChart"></canvas>
                        </div>
                    </section>
                </div>
            </div>
        </div>

        <!-- Página 2: Comparativo por Técnico -->
        <div id="page-comparative" class="page-content no-print">
            <h3 class="section-title">Evolução de Notas Baixas por Técnico</h3>
            <div id="comparative-charts-container" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                <!-- Gráficos comparativos serão inseridos aqui -->
            </div>
        </div>

        <!-- Página 3: Ranking Geral -->
        <div id="page-ranking" class="page-content no-print">
            <h3 class="section-title">Ranking Geral de Atendentes</h3>
            <p class="text-sm text-slate-400 mb-6">O ranking é calculado com base na Nota Média Ponderada (principal), Menor Qtd. de Notas Baixas, Maior Nº de Ativações e Menor TMA Ponderado, de todos os períodos combinados.</p>
            <div id="ranking-table-container" class="glass-card p-4 sm:p-6 rounded-xl overflow-x-auto">
                <!-- A tabela será gerada pelo JS -->
            </div>
        </div>


        <footer class="text-center text-sm text-gray-500 mt-12 pt-6 border-t border-slate-700">
            Relatório gerado em <span id="generation-date"></span> para Internet Mais.
        </footer>
    </div>

    <script>
        // Envolve todo o script em um listener para garantir que o DOM esteja carregado
        // e para evitar poluir o escopo global.
        document.addEventListener('DOMContentLoaded', function() {
            
            document.getElementById('generation-date').textContent = new Date().toLocaleDateString('pt-BR', { day: '2-digit', month: 'long', year: 'numeric' });
            
            // Dados organizados por mês
            const monthlyData = {
                agosto: {
                    periodLabel: '01/08 a 30/08',
                    team: [
                        { nome: 'Pedro', chat: 85, atendimentos: 7, os: 4, nota: 4.60, tma: 58, ativacoes: 0 },
                        { nome: 'Vinicius', chat: 63, atendimentos: 17, os: 6, nota: 4.57, tma: 31, ativacoes: 0 },
                        { nome: 'Paulo', chat: 86, atendimentos: 8, os: 5, nota: 4.30, tma: 43, ativacoes: 0 },
                        { nome: 'Ricardo (12x36)', chat: 117, atendimentos: 52, os: 4, nota: 4.57, tma: 57, ativacoes: 0 },
                        { nome: 'Matheus (12x36)', chat: 92, atendimentos: 2, os: 3, nota: 4.50, tma: 26, ativacoes: 0 },
                        { nome: 'Robson (12x36)', chat: 110, atendimentos: 63, os: 4, nota: 4.69, tma: 33, ativacoes: 0 },
                        { nome: 'Leonardo (12x36)', chat: 69, atendimentos: 28, os: 3, nota: 4.88, tma: 26, ativacoes: 0 }
                    ],
                    reasons: { 
                        'Sem internet/Visita': 47, 
                        'Sem Internet/Resolvido': 25, 
                        'Internet Lenta Resolvido': 63, 
                        'Internet Lenta/Visita': 30, 
                        'Rompimento de fibra': 55, 
                        'Falha Massiva': 133, 
                        'Inatividade do cliente': 73, 
                        'Assuntos Financeiros': 0, 
                        'Assuntos Comerciais': 0, 
                        'Agendamento': 0 
                    },
                    lowScores: null, // Não há dados de notas baixas para agosto
                    keyMetrics: {
                        volume: 747,
                        nota: 4.59,
                        tma: 39.1
                    }
                },
                setembro: {
                    periodLabel: '01/09 a 30/09',
                    team: [
                        { nome: 'Pedro', chat: 324, atendimentos: 2, os: 39, nota: 4.17, tma: 86, ativacoes: 0 },
                        { nome: 'Vinicius', chat: 244, atendimentos: 63, os: 60, nota: 4.61, tma: 49, ativacoes: 0 },
                        { nome: 'Paulo', chat: 295, atendimentos: 8, os: 25, nota: 4.48, tma: 46, ativacoes: 0 },
                        { nome: 'Ricardo (12x36)', chat: 415, atendimentos: 79, os: 11, nota: 4.55, tma: 29, ativacoes: 0 },
                        { nome: 'Matheus (12x36)', chat: 418, atendimentos: 1, os: 9, nota: 4.40, tma: 21, ativacoes: 0 },
                        { nome: 'Robson (12x36)', chat: 426, atendimentos: 179, os: 15, nota: 4.69, tma: 16, ativacoes: 0 },
                        { nome: 'Leonardo (12x36)', chat: 332, atendimentos: 123, os: 17, nota: 4.30, tma: 29, ativacoes: 0 }
                    ],
                    reasons: { 
                        'Sem internet/Visita': 76, 
                        'Sem Internet/Resolvido': 68, 
                        'Internet Lenta Resolvido': 132, 
                        'Internet Lenta/Visita': 60, 
                        'Rompimento de fibra': 113, 
                        'Falha Massiva': 330, 
                        'Inatividade do cliente': 161, 
                        'Assuntos Financeiros': 222, 
                        'Assuntos Comerciais': 175, 
                        'Agendamento': 91 
                    },
                    lowScores: {
                        'Robson (12x36)': [
                            { nota: 1, count: 2},
                            { nota: 2, count: 1},
                            { nota: 3, count: 1},
                            { nota: 4, count: 21}
                        ],
                        'Matheus (12x36)': [
                            { nota: 1, count: 10},
                            { nota: 2, count: 3},
                            { nota: 3, count: 5},
                            { nota: 4, count: 40}
                        ],
                        'Vinicius': [
                            { nota: 1, count: 1},
                            { nota: 2, count: 1},
                            { nota: 3, count: 3},
                            { nota: 4, count: 17}
                        ],
                        'Ricardo (12x36)': [
                            { nota: 1, count: 9},
                            { nota: 2, count: 2},
                            { nota: 3, count: 3},
                            { nota: 4, count: 29}
                        ],
                        'Leonardo (12x36)': [
                            { nota: 1, count: 8},
                            { nota: 2, count: 4},
                            { nota: 3, count: 9},
                            { nota: 4, count: 27}
                        ],
                        'Paulo': [
                            { nota: 1, count: 6},
                            { nota: 2, count: 1},
                            { nota: 3, count: 4},
                            { nota: 4, count: 19}
                        ],
                        'Pedro': [
                            { nota: 1, count: 9},
                            { nota: 2, count: 3},
                            { nota: 3, count: 5},
                            { nota: 4, count: 23}
                        ]
                    },
                    keyMetrics: {
                        volume: 2468,
                        nota: 4.46,
                        tma: 39.4
                    }
                },
                outubro: {
                    periodLabel: '01/10 a 24/10',
                    team: [
                        { nome: 'Pedro', chat: 172, atendimentos: 19, os: 20, nota: 4.24, tma: 131, ativacoes: 16 },
                        { nome: 'Vinicius', chat: 136, atendimentos: 63, os: 23, nota: 4.75, tma: 47, ativacoes: 21 },
                        { nome: 'Paulo', chat: 170, atendimentos: 49, os: 13, nota: 4.51, tma: 61, ativacoes: 39 },
                        { nome: 'Ricardo (12x36)', chat: 185, atendimentos: 83, os: 11, nota: 4.58, tma: 35, ativacoes: 4 },
                        { nome: 'Matheus (12x36)', chat: 191, atendimentos: 44, os: 8, nota: 4.50, tma: 22, ativacoes: 32 },
                        { nome: 'Robson (12x36)', chat: 298, atendimentos: 197, os: 7, nota: 4.86, tma: 17, ativacoes: 40 },
                        { nome: 'Leonardo (12x36)', chat: 205, atendimentos: 80, os: 6, nota: 4.53, tma: 33, ativacoes: 16 }
                    ],
                    reasons: { 
                        'Sem internet/Visita': 75, 
                        'Sem Internet/Resolvido': 70, 
                        'Internet Lenta Resolvido': 119, 
                        'Internet Lenta/Visita': 60, 
                        'Rompimento de fibra': 55, 
                        'Falha Massiva': 0, 
                        'Inatividade do cliente': 116, 
                        'Assuntos Financeiros': 178, 
                        'Assuntos Comerciais': 50, 
                        'Agendamento': 105 
                    },
                    lowScores: {
                        'Pedro': [
                            { nota: 1, count: 3},
                            { nota: 2, count: 1},
                            { nota: 3, count: 5},
                            { nota: 4, count: 7}
                        ],
                        'Vinicius': [
                            { nota: 1, count: 0},
                            { nota: 2, count: 1},
                            { nota: 3, count: 2},
                            { nota: 4, count: 7}
                        ],
                        'Robson (12x36)': [
                            { nota: 1, count: 0},
                            { nota: 2, count: 0},
                            { nota: 3, count: 0},
                            { nota: 4, count: 11}
                        ],
                        'Leonardo (12x36)': [
                            { nota: 1, count: 1},
                            { nota: 2, count: 2},
                            { nota: 3, count: 4},
                            { nota: 4, count: 11}
                        ],
                        'Matheus (12x36)': [
                            { nota: 1, count: 3},
                            { nota: 2, count: 1},
                            { nota: 3, count: 4},
                            { nota: 4, count: 11}
                        ],
                        'Paulo': [
                            { nota: 1, count: 2},
                            { nota: 2, count: 0},
                            { nota: 3, count: 3},
                            { nota: 4, count: 16}
                        ],
                        'Ricardo (12x36)': [
                            { nota: 1, count: 2},
                            { nota: 2, count: 1},
                            { nota: 3, count: 1},
                            { nota: 4, count: 16}
                        ]
                    },
                    keyMetrics: {
                        volume: 1357,
                        nota: 4.57,
                        tma: 49.4
                    }
                },
                'outubro-nov': {
                    periodLabel: '24/10 a 04/11',
                    team: [
                        { nome: 'Pedro', chat: 71, atendimentos: 3, os: 4, nota: 4.45, tma: 54, ativacoes: 6 },
                        { nome: 'Vinicius', chat: 83, atendimentos: 27, os: 0, nota: 4.56, tma: 54, ativacoes: 13 }, // PDF não informou OS
                        { nome: 'Paulo', chat: 72, atendimentos: 13, os: 4, nota: 4.52, tma: 57, ativacoes: 10 },
                        { nome: 'Ricardo (12x36)', chat: 101, atendimentos: 52, os: 2, nota: 4.81, tma: 36, ativacoes: 7 }, // Corrigido de 4:81
                        { nome: 'Matheus (12x36)', chat: 90, atendimentos: 29, os: 2, nota: 4.60, tma: 31, ativacoes: 10 },
                        { nome: 'Robson (12x36)', chat: 135, atendimentos: 83, os: 4, nota: 4.72, tma: 20, ativacoes: 11 },
                        { nome: 'Leonardo (12x36)', chat: 77, atendimentos: 27, os: 2, nota: 4.48, tma: 21, ativacoes: 6 } // Corrigido de 4,48
                    ],
                    reasons: { 
                        'Sem internet/Visita': 0, // PDF não informou
                        'Sem Internet/Resolvido': 31, 
                        'Internet Lenta Resolvido': 54, // Corrigido de "Intiemet"
                        'Internet Lenta/Visita': 23, 
                        'Rompimento de fibra': 0, // PDF não informou
                        'Falha Massiva': 0, // PDF não informou
                        'Inatividade do cliente': 44, 
                        'Assuntos Financeiros': 107, 
                        'Assuntos Comerciais': 0, // PDF não informou
                        'Agendamento': 0 // PDF não informou
                    },
                    lowScores: {
                        'Pedro': [
                            { nota: 1, count: 2},
                            { nota: 2, count: 1},
                            { nota: 3, count: 1},
                            { nota: 4, count: 3}
                        ],
                        'Vinicius': [
                            { nota: 1, count: 0},
                            { nota: 2, count: 1},
                            { nota: 3, count: 2},
                            { nota: 4, count: 4}
                        ],
                        'Robson (12x36)': [
                            { nota: 1, count: 0},
                            { nota: 2, count: 0},
                            { nota: 3, count: 1},
                            { nota: 4, count: 6}
                        ],
                        'Leonardo (12x36)': [
                            { nota: 1, count: 2},
                            { nota: 2, count: 0},
                            { nota: 3, count: 0},
                            { nota: 4, count: 9}
                        ],
                        'Matheus (12x36)': [
                            { nota: 1, count: 1},
                            { nota: 2, count: 0},
                            { nota: 3, count: 1},
                            { nota: 4, count: 6}
                        ],
                        'Paulo': [
                            { nota: 1, count: 1},
                            { nota: 2, count: 0},
                            { nota: 3, count: 1},
                            { nota: 4, count: 8}
                        ],
                        'Ricardo (12x36)': [
                            { nota: 1, count: 0},
                            { nota: 2, count: 0},
                            { nota: 3, count: 1},
                            { nota: 4, count: 5}
                        ]
                    },
                    keyMetrics: {
                        volume: 631,
                        nota: 4.59, // Média calculada: (4.45 + 4.56 + 4.52 + 4.81 + 4.60 + 4.72 + 4.48) / 7
                        tma: 39.0 // Média calculada: (54 + 54 + 57 + 36 + 31 + 20 + 21) / 7
                    }
                },
                'novembro-inicio': {
                    periodLabel: '01/11 a 10/11',
                    team: [
                        { nome: 'Pedro', chat: 33, atendimentos: 3, os: 8, nota: 3.82, tma: 101, ativacoes: 0 },
                        { nome: 'Vinicius', chat: 97, atendimentos: 20, os: 6, nota: 4.32, tma: 56, ativacoes: 7 },
                        { nome: 'Paulo', chat: 107, atendimentos: 0, os: 7, nota: 4.39, tma: 43, ativacoes: 0 }, // PDF não informou atendimentos
                        { nome: 'Ricardo (12x36)', chat: 108, atendimentos: 45, os: 2, nota: 4.73, tma: 32, ativacoes: 1 },
                        { nome: 'Matheus (12x36)', chat: 133, atendimentos: 30, os: 4, nota: 4.78, tma: 23, ativacoes: 5 },
                        { nome: 'Robson (12x36)', chat: 207, atendimentos: 115, os: 6, nota: 4.78, tma: 14, ativacoes: 11 },
                        { nome: 'Leonardo (12x36)', chat: 117, atendimentos: 36, os: 1, nota: 4.42, tma: 23, ativacoes: 4 } // Corrigido de 442
                    ],
                    reasons: { 
                        'Sem internet/Visita': 34,
                        'Sem Internet/Resolvido': 87, 
                        'Internet Lenta/Resolvido': 40,
                        'Internet Lenta/Visita': 26, 
                        'Rompimento de fibra': 66,
                        'Falha Massiva': 89,
                        'Inatividade do cliente': 63, 
                        'Assuntos Financeiros': 172, 
                        'Assuntos Comerciais': 11,
                        'Agendamento': 31
                    },
                    lowScores: {
                        'Pedro': [
                            { nota: 1, count: 1},
                            { nota: 2, count: 1},
                            { nota: 3, count: 2},
                            { nota: 4, count: 2}
                        ],
                        'Vinicius': [
                            { nota: 1, count: 2},
                            { nota: 2, count: 1},
                            { nota: 3, count: 1},
                            { nota: 4, count: 4}
                        ],
                        'Robson (12x36)': [
                            { nota: 1, count: 0},
                            { nota: 2, count: 0},
                            { nota: 3, count: 0},
                            { nota: 4, count: 11}
                        ],
                        'Leonardo (12x36)': [
                            { nota: 1, count: 4},
                            { nota: 2, count: 0},
                            { nota: 3, count: 0},
                            { nota: 4, count: 9}
                        ],
                        'Matheus (12x36)': [
                            { nota: 1, count: 0},
                            { nota: 2, count: 0},
                            { nota: 3, count: 1},
                            { nota: 4, count: 9}
                        ],
                        'Paulo': [
                            { nota: 1, count: 1},
                            { nota: 2, count: 1},
                            { nota: 3, count: 4},
                            { nota: 4, count: 7}
                        ],
                        'Ricardo (12x36)': [
                            { nota: 1, count: 0},
                            { nota: 2, count: 0},
                            { nota: 3, count: 3},
                            { nota: 4, count: 7}
                        ]
                    },
                    keyMetrics: {
                        volume: 802,
                        nota: 4.46, // Média calculada
                        tma: 41.7 // Média calculada
                    }
                },
                'novembro-meio': {
                    periodLabel: '10/11 a 20/11',
                    team: [
                        { nome: 'Pedro', chat: 36, atendimentos: 15, os: 6, nota: 4.13, tma: 246, ativacoes: 9 },
                        { nome: 'Vinicius', chat: 0, atendimentos: 0, os: 0, nota: 0, tma: 0, ativacoes: 0 }, // FÉRIAS
                        { nome: 'Paulo', chat: 64, atendimentos: 1, os: 6, nota: 4.76, tma: 60, ativacoes: 23 },
                        { nome: 'Ricardo (12x36)', chat: 90, atendimentos: 41, os: 7, nota: 4.61, tma: 37, ativacoes: 7 },
                        { nome: 'Matheus (12x36)', chat: 91, atendimentos: 23, os: 6, nota: 4.37, tma: 23, ativacoes: 8 },
                        { nome: 'Robson (12x36)', chat: 171, atendimentos: 93, os: 4, nota: 4.66, tma: 19, ativacoes: 25 },
                        { nome: 'Leonardo (12x36)', chat: 94, atendimentos: 36, os: 3, nota: 4.68, tma: 43, ativacoes: 2 }
                    ],
                    reasons: { 
                        'Sem internet/Visita': 34,
                        'Sem Internet/Resolvido': 87, 
                        'Internet Lenta/Resolvido': 40,
                        'Internet Lenta/Visita': 26, 
                        'Rompimento de fibra': 66,
                        'Falha Massiva': 89,
                        'Inatividade do cliente': 63, 
                        'Assuntos Financeiros': 172, 
                        'Assuntos Comerciais': 11,
                        'Agendamento': 31
                    },
                    lowScores: {
                        'Pedro': [
                            { nota: 1, count: 3},
                            { nota: 2, count: 0},
                            { nota: 3, count: 3},
                            { nota: 4, count: 3}
                        ],
                        'Vinicius': [
                            { nota: 1, count: 0},
                            { nota: 2, count: 0},
                            { nota: 3, count: 0},
                            { nota: 4, count: 0}
                        ],
                        'Robson (12x36)': [
                            { nota: 1, count: 0},
                            { nota: 2, count: 1},
                            { nota: 3, count: 1},
                            { nota: 4, count: 9}
                        ],
                        'Leonardo (12x36)': [
                            { nota: 1, count: 0},
                            { nota: 2, count: 0},
                            { nota: 3, count: 1},
                            { nota: 4, count: 7}
                        ],
                        'Matheus (12x36)': [
                            { nota: 1, count: 1},
                            { nota: 2, count: 1},
                            { nota: 3, count: 3},
                            { nota: 4, count: 6}
                        ],
                        'Paulo': [
                            { nota: 1, count: 0},
                            { nota: 2, count: 0},
                            { nota: 3, count: 0},
                            { nota: 4, count: 5}
                        ],
                        'Ricardo (12x36)': [
                            { nota: 1, count: 1},
                            { nota: 2, count: 0},
                            { nota: 3, count: 1},
                            { nota: 4, count: 6}
                        ]
                    },
                    keyMetrics: {
                        volume: 546, // Soma dos chats (ignorando "802" do PDF que parece copiado)
                        nota: 4.53, // Média calculada (excluindo Vinicius)
                        tma: 71.3 // Média calculada (excluindo Vinicius)
                    }
                }
            };

            // Variáveis para armazenar as instâncias dos gráficos
            let performanceChart = null;
            let lowScoresChart = null;
            let comparativeCharts = {}; // Objeto para guardar os gráficos comparativos

            // Ícones para os cards de atendentes (mantidos os azuis para contraste)
            const icons = {
                chat: `<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-blue-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 5v8a2 2 0 01-2 2h-5l-5 4v-4H4a2 2 0 01-2-2V5a2 2 0 012-2h12a2 2 0 012 2zM7 8H5v2h2V8zm2 0h2v2H9V8zm6 0h-2v2h2V8z" clip-rule="evenodd" /></svg>`,
                atendimentos: `<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-blue-400" viewBox="0 0 20 20" fill="currentColor"><path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z" /></svg>`,
                os: `<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-blue-400" viewBox="0 0 20 20" fill="currentColor"><path d="M10 2a6 6 0 00-6 6v3.586l-1.707 1.707A1 1 0 003 15v4a1 1 0 001 1h12a1 1 0 001-1v-4a1 1 0 00-.293-.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z" /></svg>`,
                nota: `<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-blue-400" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>`,
                tma: `<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-blue-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.414-1.414L11 10.586V6z" clip-rule="evenodd" /></svg>`,
                ativacoes: `<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-green-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>`
            };
            
            // Configuração para gerar os cards de métricas de atendente dinamicamente
            const metricConfig = {
                chat: { label: 'Conversas Chat', icon: icons.chat, format: (val) => val },
                atendimentos: { label: 'Atendimentos IXC', icon: icons.atendimentos, format: (val) => val },
                os: { label: 'OS Finalizadas', icon: icons.os, format: (val) => val },
                ativacoes: { label: 'Ativações', icon: icons.ativacoes, format: (val) => val },
                nota: { label: 'Nota OPA', icon: icons.nota, format: (val) => val.toFixed(2) },
                tma: { label: 'TMA (min)', icon: icons.tma, format: (val) => val }
            };

            /**
             * Função para "limpar" um texto para ser usado como ID HTML (CORRIGIDA)
             * @param {string} text - O texto a ser limpo
             * @returns {string} - O texto seguro para ID
             */
            function slugify(text) {
                if (typeof text !== 'string') return '';
                // Prefixa para garantir que não comece com número e remove caracteres problemáticos
                const slug = text.toString().toLowerCase()
                    .replace(/\s+/g, '-')           // Substitui espaços por -
                    .replace(/[^a-z0-9\-]/g, '')   // Remove TUDO exceto letras minúsculas, números, hífens
                    .replace(/\-\-+/g, '-')         // Limpa hífens duplicados
                    .replace(/^-+/, '')
                    .replace(/-+$/, '');
                return `chart-attendant-${slug}`; // Retorna um ID prefixado e seguro
            }

            /**
             * Função principal para atualizar todo o relatório com base no mês selecionado.
             * @param {string} selectedMonth - A chave do mês (ex: 'agosto', 'setembro').
             */
            function updateReport(selectedMonth) {
                const data = monthlyData[selectedMonth];
                if (!data) {
                    console.error("Dados não encontrados para o mês:", selectedMonth);
                    return;
                }
                
                // Atualizar título do período (agora vindo do objeto de dados)
                document.getElementById('period-text').textContent = data.periodLabel;
                
                // Chamar as funções de atualização
                updateKeyMetrics(data);
                updatePerformanceChart(data);
                updateTeamPerformance(data);
                updateReasons(data);
                updateQualitativeAnalysis(data);
            }

            /**
             * Atualiza os cards de Métricas Chave.
             * @param {object} data - O objeto de dados para o mês selecionado.
             */
            function updateKeyMetrics(data) {
                const metricsContainer = document.getElementById('key-metrics');
                const metrics = data.keyMetrics;
                
                metricsContainer.innerHTML = `
                    <div class="glass-card p-6 rounded-xl">
                        <p class="text-gray-400 font-medium">Volume de Atendimentos</p>
                        <p class="text-3xl font-bold text-white mt-2">${metrics.volume}</p>
                    </div>
                    <div class="glass-card p-6 rounded-xl">
                        <p class="text-gray-400 font-medium">Nota Média OPA</p>
                        <p class="text-3xl font-bold text-white mt-2">${metrics.nota}</p>
                    </div>
                    <div class="glass-card p-6 rounded-xl">
                        <p class="text-gray-400 font-medium">TMA Média (min)</p>
                        <p class="text-3xl font-bold text-white mt-2">${metrics.tma}</p>
                    </div>
                `;
            }

            /**
             * Atualiza o gráfico de desempenho (Nota OPA vs TMA).
             * @param {object} data - O objeto de dados para o mês selecionado.
             */
            function updatePerformanceChart(data) {
                const ctx = document.getElementById('performanceChart').getContext('2d');
                
                // Destruir gráfico anterior se existir
                if (performanceChart) {
                    performanceChart.destroy();
                }
                
                const labels = data.team.map(m => m.nome);
                
                performanceChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Nota OPA',
                                data: data.team.map(m => m.nota),
                                backgroundColor: 'rgba(0, 147, 213, 0.8)', /* Azul do logo */
                                borderColor: 'rgba(0, 147, 213, 1)', /* Azul do logo */
                                borderWidth: 1,
                                yAxisID: 'y'
                            },
                            {
                                type: 'line',
                                label: 'TMA (min)',
                                data: data.team.map(m => m.tma),
                                borderColor: 'rgba(0, 201, 108, 1)', /* Verde do logo */
                                backgroundColor: 'rgba(0, 201, 108, 0.2)', /* Verde do logo */
                                fill: false,
                                tension: 0.3,
                                yAxisID: 'y1'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            mode: 'index',
                            intersect: false,
                        },
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: {
                                    display: true,
                                    text: 'Nota Média OPA',
                                    font: { weight: 'bold' },
                                    color: '#e2e8f0' /* Cor do título do eixo */
                                },
                                ticks: { color: '#cbd5e1' }, /* Cor dos ticks */
                                grid: { color: '#334155' }, /* Cor da grade */
                                suggestedMin: 4.0,
                                suggestedMax: 5.0
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: {
                                    display: true,
                                    text: 'TMA (minutos)',
                                    font: { weight: 'bold' },
                                    color: '#e2e8f0' /* Cor do título do eixo */
                                },
                                ticks: { color: '#cbd5e1' }, /* Cor dos ticks */
                                grid: {
                                    drawOnChartArea: false,
                                    color: '#334155' /* Cor da grade */
                                },
                                suggestedMin: 0
                            },
                            x: {
                                ticks: { color: '#cbd5e1' }, /* Cor dos ticks do eixo X */
                                grid: { color: '#334155' } /* Cor da grade */
                            }
                        },
                        plugins: {
                            legend: {
                                labels: {
                                    color: '#e2e8f0' /* Cor das legendas */
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) { label += ': '; }
                                        if (context.parsed.y !== null) {
                                            if(context.dataset.type === 'line'){ 
                                                label += context.parsed.y + ' min'; 
                                            } else { 
                                                label += context.parsed.y.toFixed(2); 
                                            }
                                        }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            /**
             * Atualiza os cards de desempenho individual da equipe.
             * Gera as métricas dinamicamente com base em 'metricConfig'.
             * @param {object} data - O objeto de dados para o mês selecionado.
             */
            function updateTeamPerformance(data) {
                const teamContainer = document.getElementById('team-performance');
                teamContainer.innerHTML = '';
                
                data.team.forEach(member => {
                    // Constrói a lista de métricas dinamicamente
                    let metricsHTML = '';
                    for (const key in metricConfig) {
                        if (Object.hasOwnProperty.call(member, key)) {
                            const config = metricConfig[key];
                            const value = config.format(member[key]);
                            metricsHTML += `
                                <div class="flex justify-between items-center">
                                    <div class="flex items-center gap-2 text-gray-400">${config.icon} ${config.label}:</div>
                                    <span class="font-semibold text-gray-200">${value}</span>
                                </div>
                            `;
                        }
                    }

                    // Cria o card do atendente
                    const cardHTML = `
                        <div class="glass-card p-5 rounded-xl">
                            <h4 class="font-bold text-lg text-white">${member.nome}</h4>
                            <div class="mt-4 space-y-3 text-sm">
                                ${metricsHTML}
                            </div>
                        </div>
                    `;
                    
                    teamContainer.innerHTML += cardHTML;
                });
            }

            /**
             * Atualiza a tabela de barras com os motivos de atendimento.
             * @param {object} data - O objeto de dados para o mês selecionado.
             */
            function updateReasons(data) {
                const reasonsContainer = document.getElementById('reasons-table');
                reasonsContainer.innerHTML = '';
                
                const reasons = data.reasons;
                const allReasons = Object.keys(reasons);
                
                // Ordena do maior para o menor
                allReasons.sort((a, b) => reasons[b] - reasons[a]);
                
                let hasReasons = false;
                const maxValue = Math.max(...Object.values(reasons));

                allReasons.forEach(reason => {
                    const count = reasons[reason];
                    
                    // Não mostrar motivos com zero ocorrências
                    if (count === 0) return; 
                    
                    hasReasons = true;
                    const barWidth = maxValue > 0 ? (count / maxValue) * 100 : 0;
                    
                    const rowHTML = `
                        <div class="text-sm">
                            <div class="flex justify-between items-center mb-1.5">
                                <span class="font-medium text-gray-300">${reason}</span>
                                <span class="font-semibold text-white">${count}</span>
                            </div>
                            <div class="w-full bg-slate-700 rounded-full h-2.5">
                                <div class="bg-gradient-to-r from-[#0093d5] to-[#00c96c] h-2.5 rounded-full" style="width: ${barWidth}%"></div>
                            </div>
                        </div>
                    `;
                    reasonsContainer.innerHTML += rowHTML;
                });

                if (!hasReasons) {
                    reasonsContainer.innerHTML = `<p class="text-sm text-gray-500">Nenhum dado de motivo disponível para este período.</p>`;
                }
            }

            /**
             * Retorna as classes de cor com base na nota.
             * @param {number} nota - A nota (1, 2, 3 ou 4).
             * @returns {object} - Um objeto com as classes de 'bg', 'text' e 'ring'.
             */
            function getScoreColors(nota) {
                switch (nota) {
                    case 1: return { bg: 'bg-red-100', text: 'text-red-800', ring: 'ring-red-200' };
                    case 2: return { bg: 'bg-orange-100', text: 'text-orange-800', ring: 'ring-orange-200' };
                    case 3: return { bg: 'bg-yellow-100', text: 'text-yellow-800', ring: 'ring-yellow-200' };
                    case 4: return { bg: 'bg-blue-100', text: 'text-blue-800', ring: 'ring-blue-200' };
                    default: return { bg: 'bg-gray-800', text: 'text-gray-200', ring: 'ring-gray-700' };
                }
            }

            /**
             * Atualiza a seção de análise qualitativa (gráfico e detalhes).
             * @param {object} data - O objeto de dados para o mês selecionado.
             */
            function updateQualitativeAnalysis(data) {
                const qualitativeSection = document.getElementById('qualitative-section');
                const lowScoresContainer = document.getElementById('low-scores-analysis');
                
                if (!data.lowScores) {
                    // Ocultar análise qualitativa se não houver dados (ex: Agosto)
                    qualitativeSection.style.display = 'none';
                } else {
                    // Mostrar análise qualitativa
                    qualitativeSection.style.display = 'block';
                    
                    // Atualizar gráfico de notas baixas
                    updateLowScoresChart(data.lowScores);
                    
                    // Atualizar análise detalhada
                    lowScoresContainer.innerHTML = '';
                    const attendantLabels = Object.keys(data.lowScores);
                    
                    attendantLabels.forEach(attendant => {
                        const details = data.lowScores[attendant];
                        let detailsHTML = '';
                        
                        details.forEach(detail => {
                            if (detail.count === 0) return; // Não mostrar notas com 0 ocorrências
                            const colors = getScoreColors(detail.nota); // Usa a função auxiliar
                            detailsHTML += `
                                <div class="p-4 rounded-lg ring-1 ${colors.ring} ${colors.bg}">
                                    <h5 class="font-bold ${colors.text}">Nota ${detail.nota} <span class="font-normal text-sm ${colors.text.replace('800', '600')}">(${detail.count} avaliações)</span></h5>
                                </div>
                            `;
                        });

                        const attendantHTML = `
                            <details class="glass-card bg-slate-800/60 border border-slate-700 rounded-lg overflow-hidden">
                                <summary class="p-4 cursor-pointer flex justify-between items-center font-semibold text-white hover:bg-slate-700/60 transition-colors">
                                    ${attendant}
                                    <svg class="w-5 h-5 text-gray-400 transition-transform transform arrow-down" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                                    </svg>
                                </summary>
                                <div class="p-4 border-t border-slate-700 bg-slate-900/60">
                                    <div class="space-y-3">
                                        ${detailsHTML}
                                    </div>
                                </div>
                            </details>
                        `;
                        lowScoresContainer.innerHTML += attendantHTML;
                    });
                }
            }

            /**
             * Atualiza o gráfico de barras empilhadas das notas baixas.
             * @param {object} lowScoresData - O objeto de dados 'lowScores' do mês.
             */
            function updateLowScoresChart(lowScoresData) {
                const ctx = document.getElementById('lowScoresChart').getContext('2d');
                
                // Destruir gráfico anterior se existir
                if (lowScoresChart) {
                    lowScoresChart.destroy();
                }
                
                const lowScoresLabels = Object.keys(lowScoresData);
                const nota1Data = lowScoresLabels.map(name => lowScoresData[name].find(d => d.nota === 1)?.count || 0);
                const nota2Data = lowScoresLabels.map(name => lowScoresData[name].find(d => d.nota === 2)?.count || 0);
                const nota3Data = lowScoresLabels.map(name => lowScoresData[name].find(d => d.nota === 3)?.count || 0);
                const nota4Data = lowScoresLabels.map(name => lowScoresData[name].find(d => d.nota === 4)?.count || 0);

                lowScoresChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: lowScoresLabels,
                        datasets: [
                            { label: 'Nota 1', data: nota1Data, backgroundColor: 'rgba(220, 38, 38, 0.8)' }, // Vermelho
                            { label: 'Nota 2', data: nota2Data, backgroundColor: 'rgba(245, 158, 11, 0.8)' }, // Laranja
                            { label: 'Nota 3', data: nota3Data, backgroundColor: 'rgba(234, 179, 8, 0.8)' }, // Amarelo
                            { label: 'Nota 4', data: nota4Data, backgroundColor: 'rgba(59, 130, 246, 0.8)' } // Azul
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: { 
                                stacked: true,
                                ticks: { color: '#cbd5e1' }, /* Cor dos ticks do eixo X */
                                grid: { color: '#334155' } /* Cor da grade */
                            },
                            y: { 
                                stacked: true,
                                title: {
                                    display: true,
                                    text: 'Quantidade de Avaliações',
                                    font: { weight: 'bold' },
                                    color: '#e2e8f0' /* Cor do título do eixo */
                                },
                                ticks: { color: '#cbd5e1' }, /* Cor dos ticks */
                                grid: { color: '#334155' } /* Cor da grade */
                            }
                        },
                        plugins: {
                            title: {
                                display: true,
                                text: `Distribuição de Notas Baixas por Atendente`,
                                font: { size: 16, weight: 'bold' },
                                color: '#e2e8f0' /* Cor do título do gráfico */
                            },
                            legend: {
                                labels: {
                                    color: '#e2e8f0' /* Cor das legendas */
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) { label += ': '; }
                                        if (context.parsed.y !== null) {
                                            label += context.parsed.y;
                                        }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });
            }


            // --- Lógica da Página Comparativa (CORRIGIDA) ---

            /**
             * Constrói a visualização comparativa (Página 2)
             * MOSTRA A EVOLUÇÃO DE NOTAS BAIXAS (1, 2, 3, 4)
             */
            function buildComparativeView() {
                const comparativeContainer = document.getElementById('comparative-charts-container');
                if (!comparativeContainer) return;

                // 1. Coletar dados de todos os atendentes
                let attendantData = {};
                let periodKeys = Object.keys(monthlyData); // ['agosto', 'setembro', ...]

                // Encontrar todos os nomes únicos de atendentes
                let allAttendantNames = new Set();
                periodKeys.forEach(key => {
                    monthlyData[key].team.forEach(member => {
                        allAttendantNames.add(member.nome);
                    });
                });

                // 2. Estruturar os dados por atendente
                allAttendantNames.forEach(name => {
                    let attendantKey = name;
                    
                    attendantData[attendantKey] = {
                        name: attendantKey,
                        labels: [],
                        nota1Counts: [],
                        nota2Counts: [],
                        nota3Counts: [],
                        nota4Counts: []
                    };

                    // Preencher dados de cada período
                    periodKeys.forEach(key => {
                        const periodLabel = monthlyData[key].periodLabel;
                        const periodLowScores = monthlyData[key].lowScores;
                        
                        attendantData[attendantKey].labels.push(periodLabel);
                        
                        let memberLowScores = null;
                        if (periodLowScores && periodLowScores[attendantKey]) {
                            memberLowScores = periodLowScores[attendantKey];
                        }

                        if (memberLowScores) {
                            attendantData[attendantKey].nota1Counts.push(memberLowScores.find(d => d.nota === 1)?.count || 0);
                            attendantData[attendantKey].nota2Counts.push(memberLowScores.find(d => d.nota === 2)?.count || 0);
                            attendantData[attendantKey].nota3Counts.push(memberLowScores.find(d => d.nota === 3)?.count || 0);
                            attendantData[attendantKey].nota4Counts.push(memberLowScores.find(d => d.nota === 4)?.count || 0);
                        } else {
                            // Se não houver dados de notas baixas (ex: Agosto)
                            attendantData[attendantKey].nota1Counts.push(0);
                            attendantData[attendantKey].nota2Counts.push(0);
                            attendantData[attendantKey].nota3Counts.push(0);
                            attendantData[attendantKey].nota4Counts.push(0);
                        }
                    });
                });

                // 3. Gerar o HTML para os gráficos
                let html = '';
                Object.keys(attendantData).sort().forEach(attendantKey => {
                    const chartId = slugify(attendantKey); // Gera o ID seguro e prefixado
                    html += `
                        <div class="glass-card p-4 sm:p-6 rounded-xl">
                            <h4 class="font-bold text-lg text-white mb-4">${attendantKey}</h4>
                            <div class="h-[300px]">
                                <canvas id="${chartId}"></canvas>
                            </div>
                        </div>
                    `;
                });
                comparativeContainer.innerHTML = html;

                // 4. Criar as instâncias do Chart.js
                for (const attendantKey in attendantData) {
                    const chartId = slugify(attendantKey); // Gera o *mesmo* ID seguro
                    const data = attendantData[attendantKey];
                    const ctx = document.getElementById(chartId); // Busca pelo ID seguro
                    
                    if (!ctx) {
                        console.error(`Canvas não encontrado para: ${chartId}`);
                        continue;
                    }

                    new Chart(ctx.getContext('2d'), {
                        type: 'bar',
                        data: {
                            labels: data.labels,
                            datasets: [
                                {
                                    label: 'Nota 1',
                                    data: data.nota1Counts,
                                    backgroundColor: 'rgba(220, 38, 38, 0.8)', // Vermelho
                                },
                                {
                                    label: 'Nota 2',
                                    data: data.nota2Counts,
                                    backgroundColor: 'rgba(245, 158, 11, 0.8)', // Laranja
                                },
                                {
                                    label: 'Nota 3',
                                    data: data.nota3Counts,
                                    backgroundColor: 'rgba(234, 179, 8, 0.8)', // Amarelo
                                },
                                {
                                    label: 'Nota 4',
                                    data: data.nota4Counts,
                                    backgroundColor: 'rgba(59, 130, 246, 0.8)', // Azul
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            interaction: {
                                mode: 'index',
                                intersect: false,
                            },
                            scales: {
                                x: {
                                    stacked: true, // Empilhar no eixo X
                                    ticks: { color: '#cbd5e1' },
                                    grid: { color: '#334155' }
                                },
                                y: {
                                    stacked: true, // Empilhar no eixo Y
                                    display: true,
                                    position: 'left',
                                    title: { display: true, text: 'Qtd. de Notas Baixas', color: '#e2e8f0', font: {weight: 'bold'} },
                                    ticks: { color: '#cbd5e1' },
                                    grid: { color: '#334155' },
                                }
                            },
                            plugins: {
                                legend: {
                                    labels: { color: '#e2e8f0' }
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            let label = context.dataset.label || '';
                                            if (label) { label += ': '; }
                                            if (context.parsed.y !== null) {
                                                label += context.parsed.y;
                                            }
                                            return label;
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            }

            /**
             * Constrói a tabela de ranking geral (Página 3)
             */
            function buildRankingPage() {
                const container = document.getElementById('ranking-table-container');
                if (!container) return;

                let attendantData = {};
                let periodKeys = Object.keys(monthlyData);

                // 1. Encontrar todos os nomes únicos
                let allAttendantNames = new Set();
                periodKeys.forEach(key => {
                    monthlyData[key].team.forEach(member => {
                        allAttendantNames.add(member.nome);
                    });
                });

                // 2. Agregar dados de todos os períodos
                allAttendantNames.forEach(name => {
                    let stats = {
                        nome: name,
                        totalChats: 0,
                        totalScorePoints: 0,
                        totalTmaPoints: 0,
                        totalAtivacoes: 0,
                        totalLowScores: 0,
                        periodsWorked: 0
                    };

                    periodKeys.forEach(key => {
                        const period = monthlyData[key];
                        const memberData = period.team.find(m => m.nome === name);

                        if (memberData) {
                            stats.periodsWorked++;
                            // Usar o volume de chat como peso. Se for 0, usar 1 para não anular a nota.
                            const chatVolume = memberData.chat > 0 ? memberData.chat : 1; 
                            stats.totalChats += memberData.chat;
                            stats.totalScorePoints += memberData.nota * chatVolume;
                            stats.totalTmaPoints += memberData.tma * chatVolume;
                            stats.totalAtivacoes += (memberData.ativacoes || 0);
                        }

                        // Agregar notas baixas
                        const lowScoresData = (period.lowScores && period.lowScores[name]) ? period.lowScores[name] : [];
                        lowScoresData.forEach(score => {
                            if (score.nota >= 1 && score.nota <= 4) {
                                stats.totalLowScores += score.count;
                            }
                        });
                    });

                    // 3. Calcular médias ponderadas
                    stats.avgNota = stats.totalChats > 0 ? (stats.totalScorePoints / stats.totalChats) : 0;
                    stats.avgTma = stats.totalChats > 0 ? (stats.totalTmaPoints / stats.totalChats) : 0;
                    
                    attendantData[name] = stats;
                });

                // 4. Criar lista e ordenar
                let rankedList = Object.values(attendantData);
                
                rankedList.sort((a, b) => {
                    // 1. Maior Nota Média Ponderada
                    if (a.avgNota !== b.avgNota) return b.avgNota - a.avgNota;
                    // 2. Menor Qtd. de Notas Baixas
                    if (a.totalLowScores !== b.totalLowScores) return a.totalLowScores - b.totalLowScores;
                    // 3. Maior No. de Ativações
                    if (a.totalAtivacoes !== b.totalAtivacoes) return b.totalAtivacoes - a.totalAtivacoes;
                    // 4. Menor TMA Médio Ponderado
                    if (a.avgTma !== b.avgTma) return a.avgTma - b.avgTma;
                    // 5. Maior No. de Chats (desempate final)
                    return b.totalChats - a.totalChats;
                });

                // 5. Gerar HTML da Tabela
                let tableHTML = `
                    <table class="w-full text-left text-sm text-slate-300">
                        <thead class="border-b border-slate-600 text-xs text-slate-400 uppercase">
                            <tr>
                                <th scope="col" class="px-4 py-3 text-center">Rank</th>
                                <th scope="col" class="px-4 py-3">Atendente</th>
                                <th scope="col" class="px-4 py-3 text-center">Nota Média Ponderada</th>
                                <th scope="col" class="px-4 py-3 text-center">Total de Notas Baixas</th>
                                <th scope="col" class="px-4 py-3 text-center">Total de Ativações</th>
                                <th scope="col" class="px-4 py-3 text-center">TMA Média Ponderado</th>
                                <th scope="col" class="px-4 py-3 text-center">Total de Chats</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                rankedList.forEach((stats, index) => {
                    tableHTML += `
                        <tr class="border-b border-slate-700 hover:bg-slate-700/50">
                            <td class="px-4 py-4 font-medium text-lg text-white text-center">${index + 1}</td>
                            <td class="px-4 py-4 font-medium text-white whitespace-nowrap">${stats.nome}</td>
                            <td class="px-4 py-4 text-center font-bold text-lg ${stats.avgNota >= 4.5 ? 'text-green-400' : 'text-yellow-400'}">${stats.avgNota.toFixed(2)}</td>
                            <td class="px-4 py-4 text-center ${stats.totalLowScores <= 20 ? 'text-green-400' : 'text-red-400'}">${stats.totalLowScores}</td>
                            <td class="px-4 py-4 text-center">${stats.totalAtivacoes}</td>
                            <td class="px-4 py-4 text-center">${stats.avgTma.toFixed(1)} min</td>
                            <td class="px-4 py-4 text-center">${stats.totalChats}</td>
                        </tr>
                    `;
                });

                tableHTML += `
                        </tbody>
                    </table>
                `;
                
                container.innerHTML = tableHTML;
            }
            
            // --- Lógica das Abas ---

            /**
             * Alterna entre as páginas de visualização.
             * @param {string} pageId - O ID da página de conteúdo a ser mostrada (ex: 'page-overview').
             */
            function switchPage(pageId) {
                // Esconde todos os conteúdos
                document.querySelectorAll('.page-content').forEach(page => {
                    page.classList.remove('active');
                });
                // Desativa todas as abas
                document.querySelectorAll('.page-tab').forEach(tab => {
                    tab.classList.remove('active');
                });

                // Mostra o conteúdo da página selecionada
                const contentToShow = document.getElementById(pageId);
                if (contentToShow) {
                    contentToShow.classList.add('active');
                }
                
                // Ativa a aba correspondente
                const tabToActivate = document.querySelector(`.page-tab[data-page="${pageId}"]`);
                if (tabToActivate) {
                    tabToActivate.classList.add('active');
                }
            }

            // --- Inicialização ---

            // Inicializar a "Visão Geral" com o período mais recente
            updateReport('novembro-meio');
            
            // Construir a "Página Comparativa" (só precisa ser feito uma vez)
            buildComparativeView();

            // Construir a "Página de Ranking" (só precisa ser feito uma vez)
            buildRankingPage();

            // Adicionar evento de mudança no seletor de mês
            document.getElementById('month-select').addEventListener('change', function() {
                updateReport(this.value);
            });

            // Adicionar eventos de clique nas abas
            document.querySelectorAll('.page-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    switchPage(this.dataset.page);
                });
            });

        }); // Fim do DOMContentLoaded
    </script>
</body>
</html>
